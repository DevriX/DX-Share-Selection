!function($){$.fn.selectedTextSharer=function(options){var options=$.extend({title:"Share",lists:"Google,http://www.google.com/search?q=%s",truncateChars:115,extraClass:"",borderColor:"#444",background:"#fff",titleColor:"#f2f2f2",hoverColor:"#ffffcc",textColor:"#000"},options),listSplit=[],lstSplit=[];function getSelectionText(){return window.getSelection?selectionTxt=window.getSelection():document.getSelection?selectionTxt=document.getSelection():document.selection&&(selectionTxt=document.selection.createRange().text),selectionTxt}function init(ele){!function(){for(listSplit=options.lists.split("|"),i=0;i<listSplit.length;i++)lstSplit[i]=listSplit[i].split(",")}(),function(ele,e){e=e||window.event,stsBox='<div class="stsBox '+options.extraClass+'"><div class="title">'+options.title+'</div><div class="list"><ul></ul></div><span class="arrow"></span></div>',ele.height()==$("body").height()?ele.append(stsBox):ele.after(stsBox)}(ele),function(ele){for(stsBoxEle=ele.height()==$("body").height()?ele.find(".stsBox"):ele.next(".stsBox"),i=0;i<listSplit.length;i++)null!=lstSplit[i][0]&&(img=null!=lstSplit[i][2]?(iconUrl=lstSplit[i][2].split(" ").join(""),"favicon"==iconUrl?'<img src="'+(-1!=(url=lstSplit[i][1]).indexOf(".")&&-1!=url.indexOf("/")&&url.substr(0,url.indexOf("/",url.indexOf("."))+1))+'favicon.ico" width="16" height="16" alt="'+lstSplit[i][0]+'"/> ':'<img src="'+lstSplit[i][2]+'" width="16" height="16" alt="'+lstSplit[i][0]+'"/> '):"",tempList="<li>"+img+'<a rel="'+lstSplit[i][1]+'" title="'+lstSplit[i][0]+'" href="#">'+lstSplit[i][0]+"</a></li>",stsBoxEle.find("ul").append(tempList));var url}(ele),function(ele){stsBoxEle=ele.height()==$("body").height()?ele.find(".stsBox"):ele.next(".stsBox"),stsBoxEle.css({display:"none","z-index":200,position:"absolute",overflow:"hidden",border:"1px solid #CCC","white-space":"nowrap","font-family":"sans-serif",background:"#FFF",color:"#333","border-radius":"5px",padding:0}),stsBoxEle.find("img").css({"vertical-align":"middle"}),stsBoxEle.find(".title").css({color:options.textColor,background:options.titleColor,padding:"3","border-bottom":"1px solid #e5e5e5"}),stsBoxEle.find(".title").find("a").css({float:"right","padding-left":"5","padding-right":"5"}),stsBoxEle.find("a").css({color:options.textColor,"text-decoration":"none"}),stsBoxEle.find(".list").css({background:options.background}),$(".stsBox ul, .stsBox li").css({padding:"2px",cursor:"pointer","list-style-type":"none",transition:"all .3s ease","user-select":"none"}),$(".stsBox li:hover").css({"background-color":"#DEF"}),$(".stsBox li").css({padding:"3"}),stsBoxEle.find(".arrow").css({width:0,height:0,"line-height":0,"border-left":"10px solid transparent","border-top":"15px solid "+options.borderColor,position:"absolute",bottom:"-19px"}),stsBoxEle.find("li").hover(function(){$(this).css({background:options.hoverColor})},function(){$(this).css({background:"none"})})}(ele)}return String.prototype.trunc=function(n){return this.substr(0,n-1)+(this.length>n?"...":"")},this.each(function(){init($(this)),$(this).on("touchend mouseup",function(e){var x,y;$(e.target).closest(".stsBox").length||""!=getSelectionText()&&(stsBoxEle=$(this).height()==$("body").height()?$(this).find(".stsBox"):$(this).next(".stsBox"),x=e.pageX,y=e.pageY,stsBoxEle.fadeIn("fast"),stsBoxEle.outerHeight()<=y?stsBoxEle.css({top:y-(stsBoxEle.outerHeight()+$(".stsBox li a").length),left:x+30}):stsBoxEle.css({top:y-(stsBoxEle.outerHeight()-30*$(".stsBox li a").length),left:x+30}),$(".stsBox li a").each(function(){$(this).attr("rev",getSelectionText())}))}),$(".stsBox li").click(function(){sUrl=$(this).children("a").attr("rel"),selectedText=$(this).children("a").attr("rev"),theUrl=sUrl.replace("%s",selectedText),theUrl=theUrl.replace("%ts",selectedText.trunc(options.truncateChars)),window.open(theUrl,"sts_window")}),$(document).on("touchstart mousedown ",function(e){$(e.target).closest(".stsBox").length||$(".stsBox").fadeOut("fast")}),$(window).blur(function(e){$(".stsBox").fadeOut("fast")})})}}(jQuery);