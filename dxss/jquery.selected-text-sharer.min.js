!function(t){t.fn.selectedTextSharer=function(s){s=t.extend({title:"Share",lists:"Google,http://www.google.com/search?q=%s",truncateChars:115,extraClass:"",borderColor:"#444",background:"#fff",titleColor:"#f2f2f2",hoverColor:"#ffffcc",textColor:"#000",isPreview:!1},s);var e=[],o=[];function n(){return window.getSelection?selectionTxt=window.getSelection():document.getSelection?selectionTxt=document.getSelection():document.selection&&(selectionTxt=document.selection.createRange().text),selectionTxt}function l(n){!function(){for(e=s.lists.split("|"),i=0;i<e.length;i++)o[i]=e[i].split(",")}(),function(e,o){o=o||window.event,stsBox='<div class="stsBox '+s.extraClass+'"><div class="title">'+s.title+'</div><div class="list"><ul></ul></div><span class="arrow"></span></div>',e.height()==t("body").height()?e.append(stsBox):e.after(stsBox)}(n),function(s){for(s.height()==t("body").height()?stsBoxEle=s.find(".stsBox"):stsBoxEle=s.next(".stsBox"),i=0;i<e.length;i++)null!=o[i][0]&&(null!=o[i][2]?(iconUrl=o[i][2].split(" ").join(""),"favicon"==iconUrl?img='<img src="'+(-1!=(n=o[i][1]).indexOf(".")&&-1!=n.indexOf("/")&&n.substr(0,n.indexOf("/",n.indexOf("."))+1))+'favicon.ico" width="16" height="16" alt="'+o[i][0]+'"/> ':img='<img src="'+o[i][2]+'" width="16" height="16" alt="'+o[i][0]+'"/> '):img="",tempList="<li>"+img+'<a rel="'+o[i][1]+'" title="'+o[i][0]+'" href="#">'+o[i][0]+"</a></li>",stsBoxEle.find("ul").append(tempList));var n}(n),function(e){e.height()==t("body").height()?stsBoxEle=e.find(".stsBox"):stsBoxEle=e.next(".stsBox"),stsBoxEle.css({display:"block","z-index":200,position:"absolute",overflow:"hidden",border:"1px solid "+s.borderColor,"white-space":"nowrap","font-family":"sans-serif",background:"#FFF",color:"#333","border-radius":"5px",padding:0}),stsBoxEle.find("img").css({"vertical-align":"middle"}),stsBoxEle.find(".title").css({color:s.textColor,background:s.titleColor,padding:"10px","border-bottom":"1px solid #e5e5e5"}),stsBoxEle.find(".title").find("a").css({float:"right","padding-left":"5","padding-right":"5"}),stsBoxEle.find("a").css({color:s.textColor,"text-decoration":"none"}),stsBoxEle.find(".list").css({background:s.background,padding:"7px"}),t(".stsBox ul, .stsBox li").css({padding:"2px",cursor:"pointer","list-style-type":"none",transition:"all .3s ease","user-select":"none","margin-bottom":"5px"}),t(".stsBox ul, .stsBox li img").css({"margin-bottom":"3px"}),t(".stsBox li:hover").css({"background-color":"#DEF"}),t(".stsBox li").css({padding:"3"}),stsBoxEle.find(".arrow").css({width:0,height:0,"line-height":0,"border-left":"10px solid transparent","border-top":"15px solid "+s.borderColor,position:"absolute",bottom:"-19px"}),stsBoxEle.find("li").hover(function(){t(this).css({background:s.hoverColor})},function(){t(this).css({background:"none"})})}(n)}return String.prototype.trunc=function(t){return this.substr(0,t-1)+(this.length>t?"...":"")},this.each(function(){l(t(this)),t(this).mouseup(function(s){if(!t(s.target).closest(".stsBox").length&&""!=n()){t(this).height()==t("body").height()?stsBoxEle=t(this).find(".stsBox"):stsBoxEle=t(this).next(".stsBox");var e=s.pageX,o=s.pageY;stsBoxEle.fadeIn("fast"),stsBoxEle.outerHeight()<=o?stsBoxEle.css({top:o-(stsBoxEle.outerHeight()+t(".stsBox li a").length),left:e+30}):stsBoxEle.css({top:o-(stsBoxEle.outerHeight()-30*t(".stsBox li a").length),left:e+30}),t(".stsBox li a").each(function(){t(this).attr("rev",n())})}}),t(".stsBox li").click(function(){sUrl=t(this).children("a").attr("rel"),selectedText=t(this).children("a").attr("rev"),theUrl=sUrl.replace("%s",selectedText),theUrl=theUrl.replace("%ts",selectedText.trunc(s.truncateChars)),window.open(theUrl,"sts_window")}),t("img").on("error",function(t){t.target.style.display="none"}),t(document).mousedown(function(s){t(s.target).closest(".stsBox").length||t(".stsBox").fadeOut("fast")}),t(window).blur(function(s){t(".stsBox").fadeOut("fast")})})}}(jQuery);